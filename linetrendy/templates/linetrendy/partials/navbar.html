<!-- Header with Navigation -->
<header class="sticky top-0 z-50 bg-white shadow-sm">
    <div class="container mx-auto px-4 py-3">
        <div class="flex justify-between items-center">
            <!-- Logo -->
            <a href="/" class="flex items-center">
                <span class="text-2xl font-heading font-bold text-accent">Linetrendy</span>
               
            </a>
            
            <!-- Desktop Navigation -->
            <nav class="hidden md:flex items-center space-x-8">
                <a href="/" class="text-black hover:text-accent transition">Home</a>
                <a href="{% url 'shop:shop' %}" class="text-black hover:text-accent transition">Shop</a>
                <a href="{% url 'shop:about' %}" class="text-black hover:text-accent transition">About Us</a>
                <a href="{% url 'shop:contact' %}" class="text-black hover:text-accent transition">Contact</a>
            </nav>
            
            <!-- Icons -->
            <div class="hidden md:flex items-center space-x-6">
                {% if user.is_authenticated %}
                <div class="relative inline-block text-left" id="userDropdownContainer">
                    <!-- Trigger Button -->
                    <button id="userDropdownBtn"
                        class="flex items-center text-dark hover:text-accent transition focus:outline-none">
                        <i class="fas fa-user mr-1"></i>
                        Hello ({{ user.email|slice:":5" }}...)
                        <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M19 9l-7 7-7-7" />
                        </svg>
                    </button>

                    <!-- Dropdown Menu -->
                    <div id="userDropdownMenu"
                        class="absolute right-0 mt-2 w-40 bg-white border border-gray-200 rounded-lg shadow-lg hidden z-50">
                        <a href="{% url 'shop:account_page' %}"
                        class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                        Account
                        </a>
                        <a href="{% url 'users:custom_logout' %}"
                        class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                        Logout
                        </a>
                    </div>
                    </div>
                    {% else %}
                    <a href="{% url 'users:account_login' %}" class="text-dark hover:text-accent transition" aria-label="Account">
                    <i class="fas fa-user"></i>
                    </a>
                {% endif %}
                    
                <a href="{% url 'shop:cart' %}" class="relative text-dark hover:text-accent transition" aria-label="Cart">
                    <i class="fas fa-shopping-bag text-lg md:text-xl"></i>
                    {% include "linetrendy/partials/cart_count.html" %}
                </a>
                
            </div>
            
            <!-- Mobile Menu Button -->
            <button class="md:hidden hamburger focus:outline-none" id="menu-btn" aria-label="Menu">
                <span class="block w-6 h-0.5 bg-dark mb-1.5 transition"></span>
                <span class="block w-6 h-0.5 bg-dark mb-1.5 transition"></span>
                <span class="block w-6 h-0.5 bg-dark transition"></span>
            </button>
        </div>
        
        <!-- Mobile Menu -->
        <div class="mobile-menu md:hidden bg-white hidden" id="mobile-menu">
            <div class="flex flex-col space-y-4 py-4">
                <a href="/" class="text-black hover:text-accent transition px-4 py-2">Home</a>
                <a href="{% url 'shop:shop' %}" class="text-black hover:text-accent transition px-4 py-2">Shop</a>
                <a href="#" class="text-black hover:text-accent transition px-4 py-2">Categories</a>
                <a href="{% url 'shop:about' %}" class="text-black hover:text-accent transition px-4 py-2">About Us</a>
                <a href="{% url 'shop:contact' %}" class="text-black hover:text-accent transition px-4 py-2">Contact</a>

                <!-- Mobile User Dropdown -->
                {% if user.is_authenticated %}
                <div class="relative px-4 py-2" id="mobileUserDropdownContainer">
                    <button id="mobileUserDropdownBtn" class="flex items-center w-full text-dark hover:text-accent transition focus:outline-none">
                        <i class="fas fa-user mr-2"></i>
                        Hello ({{ user.email|slice:":5" }}...)
                        <svg class="w-4 h-4 ml-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M19 9l-7 7-7-7" />
                        </svg>
                    </button>

                    <div id="mobileUserDropdownMenu" class="mt-2 bg-white border border-gray-200 rounded-lg shadow-lg hidden">
                        <a href="{% url 'shop:account_page' %}" class="block px-4 py-2 text-gray-700 hover:bg-gray-100">Account</a>
                        <a href="{% url 'users:custom_logout' %}" class="block px-4 py-2 text-gray-700 hover:bg-gray-100">Logout</a>
                    </div>
                </div>
                {% else %}
                <a href="{% url 'users:account_login' %}" class="flex items-center px-4 py-2 text-dark hover:text-accent transition">
                    <i class="fas fa-user mr-2"></i> Login
                </a>
                {% endif %}

                <!-- Mobile Cart inside mobile menu -->
                <a href="{% url 'shop:cart' %}" 
                    class="flex items-center justify-between text-dark hover:text-accent transition px-4 py-2">
                    <div class="flex items-center space-x-2 relative">
                        <i class="fas fa-shopping-bag text-lg"></i>
                        <!-- Cart count badge -->
                        <span id="cart-count"
                            hx-swap-oob="true"
                            class="absolute -top-1 -right-1 md:-top-2 md:-right-2 bg-accent text-white text-xs md:text-sm rounded-full h-4 w-4 md:h-5 md:w-5 flex items-center justify-center overflow-hidden">
                            {{ cart_count }}
                        </span>
                    </div>
                </a>
            </div>
        </div>

    </div>
</header>


<script>
function initMenus() {
    // ===== Desktop User Dropdown =====
    const userBtn = document.getElementById('userDropdownBtn');
    const userMenu = document.getElementById('userDropdownMenu');
    if (userBtn && userMenu) {
        userBtn.onclick = function (e) {
            e.stopPropagation();
            userMenu.classList.toggle('hidden');
        };
        userMenu.onclick = e => e.stopPropagation();
    }

    // ===== Mobile Menu Toggle =====
    const menuBtn = document.getElementById('menu-btn');
    const mobileMenu = document.getElementById('mobile-menu');
    if (menuBtn && mobileMenu) {
        menuBtn.onclick = function (e) {
            e.stopPropagation();
            mobileMenu.classList.toggle('hidden');
        };
        mobileMenu.onclick = e => e.stopPropagation();
    }

    // ===== Mobile User Dropdown =====
    const mobileUserBtn = document.getElementById('mobileUserDropdownBtn');
    const mobileUserMenu = document.getElementById('mobileUserDropdownMenu');
    if (mobileUserBtn && mobileUserMenu) {
        mobileUserBtn.onclick = function (e) {
            e.stopPropagation();
            mobileUserMenu.classList.toggle('hidden');
        };
        mobileUserMenu.onclick = e => e.stopPropagation();
    }

    // ===== Close menus on outside click =====
    document.addEventListener('click', function (e) {
        if (userMenu && !userBtn?.contains(e.target) && !userMenu.contains(e.target)) {
            userMenu.classList.add('hidden');
        }
        if (mobileMenu && !menuBtn?.contains(e.target) && !mobileMenu.contains(e.target)) {
            mobileMenu.classList.add('hidden');
        }
        if (mobileUserMenu && !mobileUserBtn?.contains(e.target) && !mobileUserMenu.contains(e.target)) {
            mobileUserMenu.classList.add('hidden');
        }
    });

    // ===== Close menus on Escape key =====
    document.addEventListener('keydown', function (e) {
        if (e.key === "Escape") {
            userMenu?.classList.add('hidden');
            mobileMenu?.classList.add('hidden');
            mobileUserMenu?.classList.add('hidden');
        }
    });
}

// Run once on page load
document.addEventListener('DOMContentLoaded', initMenus);

// Re-run after any HTMX swap (e.g. cart badge updates)
document.body.addEventListener('htmx:afterSwap', initMenus);
</script>






