{% extends 'linetrendy/base.html' %}
{% load static %}

{% block content %}
<section class="bg-gray-100 min-h-screen p-4 sm:p-10">
    <div class="container mx-auto px-2 sm:px-4">
        <h1 class="text-3xl sm:text-4xl font-heading font-bold text-red-600 mb-6 sm:mb-8 text-center">Your Cart</h1>

        {% if cart_items %}
        <div class="flex flex-col lg:flex-row gap-6 lg:gap-8">

            <!-- Left: Cart Items -->
            <div class="w-full md:w-3/4 lg:w-2/3 bg-white shadow-md rounded-lg p-4 sm:p-6">
                <div id="cart-items">
                    {% for cart_item in cart_items %}
                        <div id="cart-item-{{ cart_item.id }}">
                            {% include 'linetrendy/partials/cart_item.html' with cart_item=cart_item %}
                        </div>
                    {% endfor %}
                </div>

                <!-- Keep Shopping link OUTSIDE any HTMX swap -->
                <div class="mt-6 text-center">
                    <a href="{% url 'shop:shop' %}" class="text-red-600 font-medium hover:underline">
                        ‚Üê Keep Shopping
                    </a>
                </div>
            </div>

            <!-- Right: Cart Summary -->
            <div class="w-full md:w-1/2 lg:w-1/3">
                <div id="cart-totals">
                    {% include 'linetrendy/partials/cart_totals.html' %}
                </div>
            </div>

        </div>
        {% else %}
        <p class="text-center text-red-600 text-lg mt-12">
            Your cart is empty, <a href="{% url 'shop:shop' %}" class="underline">Shop Now</a>
        </p>
        {% endif %}
    </div>
</section>



<script>
function enableCheckoutButton() {
    const select = document.getElementById("shipping_method");
    const checkoutBtn = document.getElementById("checkout-btn");

    if (!checkoutBtn) return;

    if (select && select.value) {
        checkoutBtn.classList.remove("opacity-50", "pointer-events-none");
        checkoutBtn.removeAttribute("title");
    } else {
        checkoutBtn.classList.add("opacity-50", "pointer-events-none");
        checkoutBtn.setAttribute("title", "Please choose a shipping method to continue");
    }
}

// Run on load
document.addEventListener("DOMContentLoaded", enableCheckoutButton);

// Run again if HTMX swaps cart totals (for promo codes or shipping changes)
document.body.addEventListener("htmx:afterSwap", function(event) {
    if (event.target.id === "cart-totals-wrapper") {
        enableCheckoutButton();
    }
});
</script>


{% endblock content %}
